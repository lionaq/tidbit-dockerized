{% extends 'base.html' %}

{% block title %}Profile{% endblock %}

{% block content %}

<head>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <main>

    <!-- Section: White bg -->
    <section>
      <div class="container">

        <!-- ProfilePic and CoverPic -->
        <section>
          <div class="d-flex justify-content-center cover-pic-container rounded-bottom">
            <img 
              {% if 'static' in user.coverpic %}src = "{{url_for('static', filename=user.coverpic[7:])}}"{%else%}src="{{ user.coverpic }}"{%endif%}
              class="cover-pic" 
            />
          </div>
          <div class="d-flex justify-content-center">
            <img 
            {% if 'static' in user.profilepic %}src = "{{url_for('static', filename=user.profilepic[7:])}}"{%else%}src="{{ user.profilepic }}"{%endif%}
              class="profile-pic rounded-circle" 
              />
          </div>
        </section>

        <!-- User Data -->
        <section>
          <div class=" justify-content-center text-center" style="margin-top: 68px">
            <div class = "userTop container-fluid">
              {% if current_user != user %}
                <button type="submit" class="followBtn btn btn-lg btn-secondary btn-sm" style="background-color: #D17A5E; border: none">Follow</button>
              {% endif %}

              <h5 style="margin-bottom:2px">{{ user.fullname }}</h5>
              <p class="small text-muted" style="margin-bottom: 8px">@{{ user.username }}</p>
          </div>
            {% if user.bio %}
              <p class="small py-3 bio-text">{{ user.bio }}</p>
            {% elif not user.bio %}
              <p class="default-division" style="margin-top: 68px"></p>
            {% endif %}
            
            {% if user.website %} 
              <p class="small link">
                <a href="{{ user.website }}" target="_blank" style="text-decoration: none; color: darkblue">
                  <i class="fa-solid fa-link"></i> {{ user.website }}
                </a> 
              </p> 
            {% endif %}
          </div>

          <div class="d-flex justify-content-center text-center">
            <a href="">
                <div class="d-flex px-3 py-3">
                    <h6 class="px-2" id="userFollowers">100</h6>
                    <h6 class="small text-muted">Followers</h6>
                </div>
            </a>
            <a href="">
                <div class="d-flex px-3 py-3">
                    <h6 class="px-2" id="userFollowing">100</h6>
                    <h6 class="small text-muted">Following</h6>
                </div>
            </a>
          </div>
        </section>

        <!-- Navbar: Posts, Liked, and Saved -->
        <div>
          <nav class="nav justify-content-center">
            {% if current_user == user %}
              <a href="{{ url_for('profile_bp.profile', username=user.username) }}" class="nav-link">Posts</a>
              <a href="" class="nav-link">Liked</a>
              <a href="" class="nav-link">Saved</a>
            {% else %}
              <a href="{{ url_for('profile_bp.profile', username=user.username) }}" class="nav-link">Posts</a>
            {% endif %}
          </nav>
        </div>

        <!-- User Posts Gallery -->
        <div class="img-container">
          <div class="row">
            {% for post, first_image_info in posts_with_images %}
              <div class="col-lg-3 col-md-6 mb-4">
                <div class="image-container">
                  {% if first_image_info['type'] == 'image' %}
                    <img src="{{ first_image_info['url'] }}" class="gallery-image" alt="{{ post['title'] }}">
                  {% elif first_image_info['type'] == 'video' %}
                    <video class="gallery-video">
                      <source src="{{ first_image_info['url'] }}" type="video/mp4">
                      Your browser does not support the video tag.
                    </video>
                  {% endif %}
                  <div class="image-overlay">
                    <a href="{{ url_for('post_bp.edit', post_id=post['id']) }}" class="overlay-link">
                      <i class="fa-solid fa-pen-to-square" id="editPost"></i>
                    </a>                    
                    <a href="" class="overlay-link">
                      <i class="fa-solid fa-trash" id="deletePost"></i>
                    </a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- Create post icon -->
        <a href="{{ url_for('post_bp.create') }}">
          <div class="floating-icon">
              <i class="fa-solid fa-plus"></i>
          </div>
        </a>
        
      </div>
    </section>
  </main>

  <script>
    let path = window.location.pathname;

    let links = document.querySelectorAll('.nav a');
    for (let i = 0; i < links.length; i++) {
      if (links[i].getAttribute('href') === path) {
        links[i].classList.add('active');
      }
    }
  </script>
</body>

{% endblock %}